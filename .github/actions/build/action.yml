---
runs:
  using: composite
  steps:
    - name: Create `cmake` symbolic link (Amazon Linux 2/CentOS 7)
      run: |
        if [[ "${{ matrix.image }}" =~ ^(amazonlinux:2|centos:7)$ ]]; then
          ln --symbolic cmake3 /usr/bin/cmake
        fi
      shell: bash --noprofile --norc -euxo pipefail {0}

    - name: Prepare `build` directory
      run: |
        cmake -S . -B build \
          -DCMAKE_BUILD_TYPE=${BUILD_TYPE:-Debug} \
          -DCMAKE_INSTALL_PREFIX=/usr
      shell: bash --noprofile --norc -euxo pipefail {0}

    - name: Build `mod_tile`
      run: |
        export CMAKE_BUILD_PARALLEL_LEVEL=$(nproc)
        export VERBOSE=1
        cmake --build build
      shell: bash --noprofile --norc -euxo pipefail {0}
