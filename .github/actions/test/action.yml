---
runs:
  using: composite
  steps:
    - name: Create `ctest` symbolic link (Amazon Linux 2/CentOS 7)
      run: |
        if [[ "${{ matrix.image }}" =~ ^(amazonlinux:2|centos:7)$ ]]; then
          ln --symbolic ctest3 /usr/bin/ctest
        fi
      shell: bash --noprofile --norc -euxo pipefail {0}

    - name: Test `mod_tile`
      run: >-
        ctest --output-on-failure --verbose ||
        ctest --output-on-failure --verbose --rerun-failed
      shell: bash --noprofile --norc -euxo pipefail {0}
      working-directory: build
